{% extends "base.html" %}

{% block content %}
<div class="container mx-auto ">
    {% if session %}
    <div class="flex justify-between items-center">
        <h1 class="text-2xl font-bold">Hello User</h1>
        <form method="post">
            <button type="submit" name="action" value="logout" class="btn btn-primary">Logout</button>
        </form>
    </div>

    <div class="divider"></div>
    {% endif %}




    <!-- generate api -->
    <div class="flex justify-between items-center">
        <h1 class="text-2xl font-bold">Api Keys</h1>
        <form method="post">
            <button type="submit" name="action" value="gen-api-key" class="btn btn-primary btn-outline">Generate API
                Key</button>
        </form>
    </div>

    {% if error %}
    <div role="alert" class="alert alert-error mt-4">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span>{{error}}</span>
    </div>
    {% endif %}


    <!-- show new generated api key -->
    {%if api_key %}
    <div role="alert" class="alert alert-info mt-4">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="h-6 w-6 shrink-0 stroke-current">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span>Your API Key is here, store it in secure place. You won't able to retrive it again as the api is going
            to store in hash. If you forget your API key, delete and recreate it.</span>
    </div>

    <div class="card p-4 border border-primary-200 mt-10">
        <span class="text-4xl overflow-auto font-mono">{{api_key}}</span>
    </div>
    {%endif%}

    <!-- show api_keys -->

    {% if api_keys %}
    <div class="overflow-x-auto rounded-box border border-base-content/5 bg-base-100 mt-10 mb-10">
        <table class="table w-full">
            <thead class="bg-base-300">
                <tr>
                    <th></th>
                    <th>Api Keys</th>
                    <th>Created At</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for api in api_keys %}
                <tr>
                    <th>{{loop.index}}</th>
                    <form method="post" name="edit-input" action="">
                        <td>
                            {{ api.api_key }}
                        </td>

                        <td>
                            {{ api.created_at }}
                        </td>
                        <td>
                            <form method="post">
                                <button type="submit" name="delete_api" value="{{ api.api_key }}"
                                    class="btn btn-primary btn-outline">Delete</button>
                            </form>
                        </td>
                    </form>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    <div class="divider"></div>

    <!-- delete user -->
    <div class="bg-base-100 border-base-300 collapse border">
        <input type="checkbox" class="peer" />
        <div
            class="flex justify-between collapse-title bg-error text-error-content peer-checked:bg-secondary peer-checked:text-secondary-content">
            <div>Delete Account</div>
            <p class="font-bold">+</p>
        </div>
        <div
            class="collapse-content bg-primary text-primary-content peer-checked:bg-secondary peer-checked:text-secondary-content">
            <form method="post">
                <input class="input" type="text" name="userid" placeholder="Enter User ID">
                <button type="submit" name="action" value="delete-user" class="btn btn-error">Delete Account</button>
            </form>
        </div>
    </div>

</div>
{% endblock %}